## Web Machine: (N7)

Documentation referencing vulnerabilites found on the vulnerable machine: "Web Machine: (N7)." You can also use this documentation as a reference guide to learn ethical hacking. 

- The `LINK.lst` file contains the URL for Web Machine: (N7) CTF challenge.

      Happy Hacking!
---

### Feature

- #### **TOE**:

  - *Vulnhub*

- #### Category:

  - *Reflected XSS*

- #### Location:

  - *http://192.168.1.15/enter_network/admin.php*

- #### CWE-79:

  - _Improper Neutralization of Input During Web Page Generation_

#### Goal:

- Perform a reflected XSS attack on the vulnerable machine to access admin sensitive information

#### Recommendation:

- Implement security attributes for session cookies such as HttpOnly, Secure and SameSite as well as discarding potententially harmful information recieved through data inputs

#### Hacker's software:

| Software Name      | Version |
| ------------------ | ------- |
| Burpsuite CE       | 10.3.4  |
| Kali Linux         | 5.15.0  |
| Firefox ESR        | 91.5.0  |
| Fping              | 5.1     |
| Gobuster           | 3.6     |
| Nmap               | 7.92    |
| FoxyProxy Standard | 7.5.1   |
| VirtualBox         | 6.1.48  |

#### TOE

---

Given I access the Vulnhub website

I download the .ova file associated with "web-machine-n7"

I check the MD5 hash code

I check the SHA1 hash code to verify the machine's integrity

![evidence](./evidences/img0.png)

- I confirm that both of the hash codes match:

![evidence](evidences/img1.png)

I read the vulnerable VM's description which will potentially give me some clues on how to solve it. The vulnerable VM's description says:

    "When starting out to attack the machine, the user might help by making sure the machine is up & running correctly as some machines are easier to discover on the network than others.
    DHCP service: Enabled
    IP address: Automatically assigned"

I import the .ova file using VirtualBox

I start the vulnerable VM

I start my Kali Linux VM

I use Nmap on my Kali Linux VM

I discover open ports on the vulnerable machine

![evidence](evidences/img2.png)

I see that port 80 is opened

I see that SSH port 22 is closed

I see that FTP ports 20,21 are also closed

I conclude that I can not SSH or FTP remotely to the vulnerable VM

I conclude that the data hosted on the vulnerable machine is unencrypted

---

### Scenario -- _Normal use case_

Given I set both my "Kali Linux VM" and the "vulnerable VM" to bridged mode in VirtualBox

Now both machines are on the same local network

I get the default gateway IP address of the vulnerable VM

I get its subnet mask by running the following command on my Kali Linux VM

    ip route

I send ICMP echo probes to the gateway's IP address

I find network hosts associated with it

![evidence](evidences/00.png)

I get the IP address of the vulnerable VM which in this case is

    192.168.1.6

I access the vulnerable machine using Firefox ESR

I see that the vulnerable machine is using an "/index.html" file

![evidence](evidences/01.png)

I see that the vulnerable VM has a "/profile.php" file

I see that the vulnerable VM has a fragment identifier on the "/profile.php#" file

### Scenario -- _Dynamic Detection_

Given I found the three main visibile directories hosted on the vulnerable VM

I use Gobuster to brute force vulnerable directories on the vulnerable VM

I find that there is a vulnerable file with a 200 status code called

    exploit.html

![evidence](evidences/02.png)

### Scenario -- _Exploitation_

Given I found a vulnerable file called `"/exploit.html"`

I access the "exploit.html" vulnerable file via Firefox ESR

I open my Firefox ESR web developer tools

I find that there is a URL with a localhost portion in it

![evidence](evidences/03.png)

I input the vulnerable VM's IP address into the localhost portion

![evidence](evidences/04.png)

I click on the "Submit Query" button

I find the first flag

![evidence](evidences/05.png)

I reboot the vulnerable VM

I press on my computer's keyboard the letter "e"

I access the vulnerable machine GUI's firmware

I look for the keyword "ro"

I replace the keyword "ro" with "rw"

I look for the keywords

    "quiet splash"`

I replace the keywords

    "quiet splash" for "init=/bin/bash"

I boot the vulnerable VM by pressing the key `"f10"`

I gain root access to the vulnerable VM's command line interface

I mount the file system by typing the following command on the root CLI

    mount

I change the root user's password by typing the following command

    passwd

I input my new desired root user's password twice

I execute the bootloader by running the following command on the root CLI

    exec /sbin/init

I login to the vulnerable machine using the following credentials

    Username: root
    Password: <password that I set when changing the root password on the root's CLI by running "passwd">

I use Firefox ESR to navigate to the vulnerable VM's root directory

`file:///var/www/html`

I notice that there is an `"/enter_network"` directory

![evidence](evidences/06.png)

I navigate to the `/enter_network` directory using Firefox ESR

I see a login page

![evidence](evidences/07.png)

I input a random username password

I click on the "Send" button to send an HTTP request to the vulnerable VM

I use Burp Suite with FoxyProxy Standard to capture the HTTP request

![evidence](evidences/08.png)

I send the HTTP request to the repeater

I find the Base64 encoding value for Set-Cookie=Role

![evidence](evidences/09.png)

I turn off FoxyProxy Standard on Firefox ESR

I look up the reversed MD5 hash for the Base64 encoded value

I find the reversed MD5 hash value for the Set-Cookie=Role

![evidence](evidences/10.png)

I brute force vulnerable directories within the /enter_network directory

I notice that there is an `"/admin.php"` file with a 200 status code

![evidence](evidences/11.png)

I access the /admin.php file through Firefox ESR

![evidence](evidences/12.png)

I turn on FoxyProxy Standard on Firefox ESR

I make an HTTP request to the endpoint `"/enter_network/admin.php"`

I capture the HTTP request by using Burp Suite with FoxyProxy Standard

I send the HTTP request headers to the repeater

I replace the hash value of "Cookie: Role"

I use its reversed MD5 hash value I found earlier

![evidence](evidences/13.png)

I send the request through the repeater to capture the response headers

I get the second flag !

[evidence](evidences/14.png)

### Scenario -- _Remediation_

- Given the machine is vulnerable to reflected XSS attacks

- The vulnerable machine is using port 80 which is unencrypted

- Input should be validated by using well-defined regular expressions

- SSL/TLS encryption should be used on port 443
- Use asymmetric encryption to securely exchange the private key
- Use symmetric encryption to encrypt the vulenrable machine's data
- The integrity of data hosted on the vulneable machine will be ensured

### Scenario -- _Scoring_

#### _Severity according to CVSSv3 standard_

---

- 4.7/10 (Medium) - AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:H

  - Base: Attributes that are constants over time and organizations

- 4.7/10 (Medium) - E:H/RL:O/RC:C/

  - Temporal: Attributes that measure the exploit's popularity fixability

- 4.5/10 (Medium) - CR:L/IR:L/AR:L
  - Environmental: Unique relevant attributes to a specific user
